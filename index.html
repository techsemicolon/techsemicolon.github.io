<!DOCTYPE html>
<html>
    <head lang="en">
        <title>Home &mdash; Tech.Semicolon &mdash; By Mihir Bhende</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
                    <meta name="robots" content="noindex, follow">
                <link href="https://fonts.googleapis.com/css?family=Open+Sans:300i,400,400i,600,600i,700,800|Yanone+Kaffeesatz:200,300,400,700" rel="stylesheet">
        <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-startup-image" href="/images/jackson/2048x2048.png">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="shortcut icon" sizes="76x76" href="/images/fav.png">
        <link rel="shortcut icon" sizes="120x120" href="/images/fav.png">
        <link rel="shortcut icon" sizes="128x128" href="/images/fav.png">
        <link rel="shortcut icon" sizes="152x152" href="/images/fav.png">
        <link rel="shortcut icon" sizes="196x196" href="/images/fav.png">
        <link rel="shortcut icon" sizes="512x512" href="/images/fav.png">
        <link rel="shortcut icon" sizes="1024x1024" href="/images/fav.png">
        <link rel="shortcut icon" sizes="2048x2048" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="128x128" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="196x196" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="512x512" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="1024x1024" href="/images/fav.png">
        <link rel="apple-touch-icon" sizes="2048x2048" href="/images/fav.png">

        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Tech.Semicolon activity feed" />
                                    </head>
    <body>
        <header>
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-header">
                <div class="container">
                    <a class="navbar-brand" href="/">
                        <img src="/images/logo.png" class="logo-img"/>
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarCollapse">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item"><a class="nav-link" href="/blog">Posts Archive</a></li>
                            <li class="nav-item"><a class="nav-link" href="/blog/categories">Categories</a></li>
                            <li class="nav-item"><a class="nav-link" href="/blog/tags">Tags</a></li>
                            <li class="nav-item"><a target="_blank" class="nav-link" href="https://github.com/techsemicolon">GitHub</a></li>
                            <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <main role="main" class="container">
            <div class="row">
                <div class="col-sm-12">
                        <article>
        <header>
            <h2><a href="/blog/2019/01/10/laravel-improving-readility-with-blade-directives/">Laravel improving readability with blade directives</a></h2>
        </header>
        <div class="home-article-body">
            <p>Laravel's blade templating system comes with ability to define custom directives. These directives can be very handly to improve readability of the view files. Let's do a quick recap of directives :</p>

<h3 id="blade-directives-%3A">Blade directives :</h3>

<ul>
<li>Generic directive :</li>
</ul>

<p>These directive take an argument and simply return the actions done in callback.</p>

<pre><code class="php">Blade::directive('caps', function ($expression) {
    return "&lt;?php echo ucwords($expression); ?&gt;";
});
</code></pre>

<p>You can use above in blade templates directly :</p>

<p></p>

<pre><code class="php">&lt;div&gt;{{ @cap('john smith') }}&lt;/div&gt;
</code></pre>

<p></p>

<p>It is little tricky to handle the <code>$expresssion</code> in the callback, as if you pass an array or multiple string arguments, those are passed as single string expressions. You can see that shortly in action in usage ideas section.</p>

<ul>
<li>Conditional directive :</li>
</ul>

<p>These directives take an argument and use it inside callback to return value. Now the callback's return value is then casted as boolean to consider if statements inside it will be showed or now. It is just like <code>@if ... @endif</code> directive, but more intuitive.</p>

<pre><code class="php">Blade::if('isadmin', function ($user) {
    return $user-&gt;role == 'admin';
});
</code></pre>

<p>You can use above in blade templates directly :</p>

<p></p>

<pre><code class="php">@isadmin($user)
    &lt;div&gt;
        &lt;a href="{{ route('users.all') }}"&gt;See all users&lt;/a&gt;
    &lt;/div&gt;
@endisadmin
</code></pre>

<p></p>

<p>Above is similar to this if done in usual without the conditional directive :</p>

<p></p>

<pre><code class="php">@if($user-&gt;role == 'admin')
    &lt;div&gt;
        &lt;a href="{{ route('users.all') }}"&gt;See all users&lt;/a&gt;
    &lt;/div&gt;
@endif
</code></pre>

<p></p>

<h3 id="some-usage-ideas-%3A">Some usage ideas :</h3>

<p>These directive give a great advantage to simplify your blade views and make them more readable. See few examples below :</p>

<ol>
<li>Conditional role checks :</li>
</ol>

<pre><code class="php">Blade::if('role', function ($role) {

    // Not logged in
    if(!auth()-&gt;check()){
        return false;
    }

    // Multiple roles passed in argument
    if(is_array($role)){
        return in_array(auth()-&gt;user()-&gt;role, $role);
    }

    // Single role passed in argument
    return auth()-&gt;user()-&gt;role == $role;
});
</code></pre>

<p>This makes the role conditional checks in blade much easier :</p>

<p></p>

<pre><code class="php">@role('admin')
   &lt;!-- something only an admin can see--&gt;
@elserole(['customer', 'seller'])
   &lt;!-- something only a customer or a seller an see--&gt;
@endrole
</code></pre>

<p></p>

<ol start="2">
<li>Rendering form errors :</li>
</ol>

<pre><code class="php">Blade::directive('validation', function ($expression) {

    // $expression is a string expression and 
    // hence will be a string maintaing start and end quotes
    // Trimming the quotes
    $expression = str_replace(['(', ')'], '', $expression);
    $fieldName  = trim(trim($expression, '"'), '\'');

    $errors = \Session::get('errors', new \Illuminate\Support\MessageBag);

    if($errors-&gt;has($fieldName)){
        return '&lt;span role="alert"&gt;&lt;strong&gt;' . $errors-&gt;first($fieldName) . '&lt;/strong&gt;&lt;/span&gt;';
    }

    return;
});
</code></pre>

<p>This makes the the validation errors from server end much easier in forms :</p>

<p></p>

<pre><code>&lt;form role="form" method="POST" action="{{ route('some.url') }}"&gt;
    @csrf
    &lt;div class="form-group"&gt;
        &lt;label&gt;First Name *&lt;/label&gt;
        &lt;input class="form-control" placeholder="Enter your first name" name="first_name"&gt;
        @validation("first_name")
    &lt;/div&gt;
    &lt;div class="form-group"&gt;
        &lt;label&gt;Last Name *&lt;/label&gt;
        &lt;input class="form-control" placeholder="Enter your last name" name="last_name"&gt;
        @validation("last_name")
    &lt;/div&gt;
    &lt;button type="submit" class="btn btn-primary"&gt;Submit Ticket&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<p></p>

<ol start="3">
<li>Dumping values in views fo debugging :</li>
</ol>

<pre><code class="php">Blade::directive('dd', function ($expression) {

    // $expression is a string expression and 
    // It can not be directly passed in dd($expression)
    // We can use with() helper which basically encapsulate the syntax
    // to render it properly in blade files
    return "&lt;?php dd(with({$expression})); ?&gt;";
});
</code></pre>

<p>Please note that above will not work for multiple arguments, can dd one argumenet only. Above can be then used :</p>

<p></p>

<pre><code class="php">@dd([1,2,3,4]);
</code></pre>

<p></p>

<ol start="4">
<li>Assigning values to variables in a view :</li>
</ol>

<p>Now this might be a very less possible requirement but if you want to assign a variable in a view, generally you do something like :</p>

<p></p>

<pre><code class="php">@php 
    $name = "John Doe";
@endphp
</code></pre>

<p></p>

<p>However, we can do this using blade directive :</p>

<pre><code class="php">Blade::directive('assign', function ($expression) {

    // The $expression passed in closure is a string in format '($name), value'
    // Hence we first remove the paranthesis and explode by comma
    list($name, $value) = explode(', ', str_replace(['(', ')'], '', $expression));
    return "&lt;?php {$name} = {$value}; ?&gt;";
});
</code></pre>

<p>And then simply use it as (Below example is very very simple but you can use as per your preference) :</p>

<p></p>

<pre><code class="php">@assign($name, 'John Doe')

&lt;div&gt; {{ $name }} &lt;/div&gt;
</code></pre>

<p></p>

<ol start="5">
<li>Frequent HTML elements :</li>
</ol>

<p>If you are using 3rd party HTML libraries like glyphicon or font-awesome, you need to use those in lot of places. You can use blade directive like :</p>

<pre><code class="php">Blade::directive('icon', function ($expression) {

    // The $expression passed in closure is a string in format '($name), value'
    // Hence we first remove the paranthesis and explode by comma
    $classes = str_replace(['(', ')'], '', $expression);
    $classes = str_replace(['"', '\''], '', $expression);
    $classes = str_replace(',', ' ', $classes);

    return '&lt;i class="fa ' . $classes . '" aria-hidden="false"&gt;&lt;/i&gt;';
});
</code></pre>

<p>Then it is as easy as it can get to use :</p>

<p></p>

<pre><code class="php">&lt;label&gt; @icon('fa-user', 'fa-2x') User Name &lt;/label&gt;
</code></pre>

<p></p>

<p>You can also extend this idea for input, select etc. I think once you set such directives in a project, your blade views become readble. Plus less code in a bladel file is always better.</p>

        </div>
        <p>.....</p>
        <a href="/blog/2019/01/10/laravel-improving-readility-with-blade-directives/">Read full article</a>
                    <p class="tags">
            Tags:
                        <a href="/blog/tags/laravel">laravel</a>,                         <a href="/blog/tags/php">php</a>,                         <a href="/blog/tags/blade">blade</a>,                         <a href="/blog/tags/directives">directives</a>                        </p>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2019/01/08/laravel-tap-vs-tap-vs-pipe/">Laravel tap vs tap vs pipe</a></h2>
        </header>
        <div class="home-article-body">
            <p>If you are wondering having tap 2 times in the article title is a mistake, apparently it is not. Laravel has large set of helper functions which are generic and helper functions specific to collections. Tap and pipe are very popular amongst laravel enthusiasts. Let's dive into each of of those to see what really makes them special and what differentiates them :</p>

<h3 id="the-tap-function-%3A">The tap() function :</h3>

<p>The reason of having tap 2 times in the article header is that, there are 2 implementations of tap helper function in laravel. One is in generic context and one specific to handling collections.</p>

<ul>
<li>The generic tap() function :</li>
</ul>

<p>The name tap suggests that it basically does set of actions using the value and then returns the value as if nothing happened. In other words, the tap function accepts two arguments <code>$value</code> and <code>a Closure</code>. The <code>$value</code> will be passed to the closure function. You can perform your actions in the closure where the return value of the Closure is irrelevant. At the end tap returns the same <code>$value</code> at the end.</p>

<p>For example :</p>

<pre><code class="php">$user = tap($user, function ($user) {

    $user-&gt;notify(new SendWelcomeEmail());

});
</code></pre>

<p>In the above snippet, we are passing <code>$user</code> instance to tap as first argument which is then cascaded as a parameter to closure. The closure will execute and basically send a new welcome email. Then control will come back to tap which will return the <code>$user</code> instance back.</p>

<p>Even you can just eliminate the closure and call function on it directly like below.</p>

<pre><code class="php">$user = tap($user)-&gt;notify(new SendWelcomeEmail());
</code></pre>

<p>The above will still return the user instance. The beauty of it is, you can chain the tap calls. Let's say you need to update the user role, then send the welcome email and then assign user some permissions. You can chain it all like :</p>

<pre><code class="php">$user = tap($user)-&gt;update([
    'role' =&gt; 'Customer' 
])
-&gt;notify(new SendWelcomeEmail())
-&gt;assignPermissions('CustomerRole');
</code></pre>

<p>The use of this method can be handy when certain methods do not return the object as you want. A great example is the update method itself on the eloquent model. It returns integer when used otherwise. But if used as above with tap function, it returns the object it performed the update.</p>

<ul>
<li>The collection tap() function :</li>
</ul>

<p>The tap function for collection can be used in collection function chaining. I think of it similar to javascript debug breakpoints. You pin it to print something at a point of time in your javascript and then move ahead after removing the breakpoint.</p>

<p>For example consider following example :</p>

<pre><code class="php"><br />$customers = collect([
    ['name' =&gt; 'mihir',  'is_active' =&gt; true,  'category' =&gt; 'gold'],
    ['name' =&gt; 'george', 'is_active' =&gt; true,  'category' =&gt; 'silver'],
    ['name' =&gt; 'nathen', 'is_active' =&gt; false, 'category' =&gt; 'platinum'],
    ['name' =&gt; 'steve',  'is_active' =&gt; true,  'category' =&gt; 'gold'],
    ['name' =&gt; 'shawn',  'is_active' =&gt; false, 'category' =&gt; 'gold']
]);

$activeGoldCustomers = collect($customers)
    -&gt;where('is_active', true)
    -&gt;tap(function ($activeCustomers) {
        $this-&gt;sendActiveCustomerEmail($activeCustomers);
    })
    -&gt;where('category', 'gold')
    -&gt;tap(function ($goldCustomers) {
        $this-&gt;sendOfferCode('100%Discount');
    });
</code></pre>

<p>In above example, we are just returning the customers who are currently active and fall under category gold. However, using the tap function we can perform certain actions on the go as we filter those. When we filtered for <code>is_active = true</code>, we sent activation email. Then when we added another filter for <code>category = gold</code>, we sent offer code just for active customer from gold category.</p>

<p>You can also find this handy in dumping data for debugging during the developement cycle.</p>

<p>The fundamental concept of <code>tap()</code> is just use the value and perform actions but NEVER CHANGE the value. If you think then what can change the value? <code>pipe()</code> is the answer.</p>

<h3 id="the-pipe-function-%3A">The pipe() function :</h3>

<p>Pipe function is just applicable for collections. For example consider following example :</p>

<pre><code class="php"><br />$customers = collect([
    ['name' =&gt; 'mihir',  'is_active' =&gt; true,  'category' =&gt; 'gold'],
    ['name' =&gt; 'george', 'is_active' =&gt; true,  'category' =&gt; 'silver'],
    ['name' =&gt; 'nathen', 'is_active' =&gt; false, 'category' =&gt; 'platinum'],
    ['name' =&gt; 'steve',  'is_active' =&gt; true,  'category' =&gt; 'gold'],
    ['name' =&gt; 'shawn',  'is_active' =&gt; false, 'category' =&gt; 'gold']
]);

$counts = collect($customers)
 -&gt;pipe(function($customers) {
    return [
        'active_count'      =&gt; $customers-&gt;where('is_active', true)-&gt;count(),
        'gold_count'        =&gt; $customers-&gt;where('category', 'gold')-&gt;count(),
        'silver_count'      =&gt; $customers-&gt;where('category', 'silver')-&gt;count(),
        'platinum_count'    =&gt; $customers-&gt;where('category', 'platinum')-&gt;count()
    ];
});
</code></pre>

<p>Above will basicaly return <code>[3, 3, 1, 1]</code>, but it is very clean and less code is always better.</p>

<p>Please note that the <code>pipe()</code> helper method is different than the <code>laravel pipelines</code>. However, if you read about pipelines, its is kind of similar conceptually to generic tap function where you can pass an object through multiple classes to perform set of task and then return the result value once all the tasks have been finished. A <a href="https://medium.com/@jeffochoa/understanding-laravel-pipelines-a7191f75c351">handy article</a> for the same is <a href="https://medium.com/@jeffochoa/understanding-laravel-pipelines-a7191f75c351">here</a> if you want a quick read.</p>

<p>Even if these methods are very handy, sometimes if you chain it to much it loses the element fo readability. I will suggest it is preferable to follow what the domain logic wants and group the similar processes together to tap or pipe.</p>

        </div>
        <p>.....</p>
        <a href="/blog/2019/01/08/laravel-tap-vs-tap-vs-pipe/">Read full article</a>
                    <p class="tags">
            Tags:
                        <a href="/blog/tags/laravel">laravel</a>,                         <a href="/blog/tags/php">php</a>,                         <a href="/blog/tags/helpers">helpers</a>,                         <a href="/blog/tags/collections">collections</a>                        </p>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2019/01/06/laravel-module-pattern/">Laravel Module Pattern</a></h2>
        </header>
        <div class="home-article-body">
            <p>Laravel has a folder structure which ties similar entities of MVC together e.g. controllers in one folder, views into another. There are few set-backs of this approach :</p>

<ul>
<li>If your project scales exponentially having lot of module, each of these directories scale as well. It becomes difficult to maintain.</li>
<li>If you want to remove the module entirely, there are files scattered in different folders to consider. This sometimes lead to unused files still present in your project repository.</li>
<li>Re-using a module into different project is a hassle (unless you have it installed coumpled as a plugin via composer)</li>
<li>While using code editors, as the module files are in different folders. We might need to expand the folders in project sidebar to view them at a glance. The scattered folder structure makes it difficult to for a quick view. (Forgive me for being picky here ;))</li>
</ul>

<h4 id="implementation-%3A">Implementation :</h4>

<p>Before you dive in to further sections, if you are familier with basic concepts of larave, most part of the code will be very familier to you. Tt is really easier that you might think.</p>

<ul>
<li>Creating the module :</li>
</ul>

<p>Let's create a new folder called <code>Modules</code> in the project root. (You might want to create it inside app folder, I prefer it this way.) To use the <code>\Modules</code> namespace, we need to autoload it from composer.json in the psr-4 section.</p>

<pre><code class="json"> "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Modules\\": "Modules/",
        }
    },
</code></pre>

<p>Let's dump the updated autoloads by doing following from terminal shell :</p>

<pre><code class="bash">composer dump-autoload
</code></pre>

<p>Now we are good to start with the first module. Let's consider a ticket module where user can submit a ticket from frontend and we store it into the database. We will not focus much on the actual implementation of  the ticketing ystem. We will emphasize on the structure of module.</p>

<ul>
<li>Create a new directory <code>Ticket</code>.</li>
</ul>

<p>Create a new directory <code>Ticket</code> inside <code>Modules</code> folder. I like to keep module names singular (Ticket instead of Tickets).</p>

<ul>
<li>Creating a service provider class :</li>
</ul>

<p>On a broader level, frameworks like laravel have special entry point wrappers which can find, register and instantiate the core functionalities. In case of Laravel it's the ServiceProvider class.</p>

<p>Create a new file <code>TicketServiceProvider.php</code> inside <code>Modules/Ticket</code>.</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket;

use Illuminate\Support\ServiceProvider as BaseServiceProvider;

class TicketServiceProvider extends BaseServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot() {}

    /**
     * Register any application services.
     *
     * @return void
     */
    public function register() {}
}
</code></pre>

<p>To make sure laravel considers this while booting up, we need to register it. Add this inside <code>config/app.php</code>'s  <code>providers</code> array :</p>

<pre><code class="php">App\Modules\Ticket\TicketServiceProvider::class,
</code></pre>

<ul>
<li>Creating migrations :</li>
</ul>

<p>We need to create a table to store new ticket data. Create a folder <code>Migrations</code> inside <code>Modules/Ticket</code>. 
Now we can create a new migration from terminal shell :</p>

<pre><code class="bash">php artisan make:migration create_tickets_table --path=Modules/Ticket/Migrations
</code></pre>

<p>It will create a new migration class inside <code>Modules/Ticket/Migrations</code> path. Let's add the table script :</p>

<pre><code class="php">&lt;?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class CreateTicketsTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('tickets', function (Blueprint $table) {
            $table-&gt;increments('id');
            $table-&gt;string('title')-&gt;nullable();
            $table-&gt;text('body')-&gt;nullable();
            $table-&gt;boolean('is_closed')-&gt;default(0);
            $table-&gt;timestamps();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('tickets');
    }
}
</code></pre>

<p>However, you must have noticed that this is not coming from Laravel's default <code>database/migrations</code> folder. We need to inform laravel to load this file as well for running migration. It can be done from service provider by adding following in boot method.</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket;

use Illuminate\Support\ServiceProvider as BaseServiceProvider;

class TicketServiceProvider extends BaseServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot() {

        // Load ticket module migrations from 
        // `Modules/Ticket/Migrations` folder path
        $this-&gt;loadMigrationsFrom(__DIR__.'/Migrations');
    }

    /**
     * Register any application services.
     *
     * @return void
     */
    public function register() {}
}
</code></pre>

<p>Now to run the migration from terminal shell :</p>

<pre><code class="bash">php artisan migrate
</code></pre>

<ul>
<li>Alternatively:</li>
</ul>

<p>If you are thinking <code>migrations are done very rarely, so why should we register it in service provider for a registration overhead?</code> Laravel has got you covered.</p>

<p>You can skip the step of doing <code>loadMigrationsFrom()</code> in service provider class. Instead you can specify the path while running migrations :</p>

<pre><code class="bash">php artisan migrate --path=Modules/Ticket/Migrations
</code></pre>

<p>If your project has CICD deployments, mostly it will just have the migrate command without the path option. The first method is preferable to keep it simple for deployments.</p>

<ul>
<li>Creating Model :</li>
</ul>

<p>Create a file <code>Ticket.php</code> inside <code>Modules/Ticket</code>. (You may create a <code>Models</code> folder inside <code>Modules/Ticket</code> and create model class inside it as per your preference.)</p>

<pre><code class="php">&lt;?php

namespace App\Modules\Ticket;

use Illuminate\Database\Eloquent\Builder;
use Illuminate\Database\Eloquent\Model;

class Ticket extends Model
{
    /**
     * The table associated with the model.
     *
     * @var string
     */
    protected $table = 'tickets';

    /**
     * The attributes that are mass assignable.
     *
     * @var array
     */
    protected $fillable = [
        'title',
        'body',
        'is_closed'
    ];

}
</code></pre>

<ul>
<li>Creating Controller :</li>
</ul>

<p>Create a new directory inside <code>Modules/Ticket</code> called <code>Http</code>. Let's create <code>TicketController.php</code> inside it :</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket\Http;

use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
use Modules\Ticket\Ticket;

class TicketController extends Controller
{
    /**
     * Display a form for the resource.
     *
     * @return \Illuminate\Http\Response
     */
    public function create()
    {
        return view('tickets.create');
    }

    /**
     * Store a newly created resource in storage.
     *
     * @param  Request  $request
     * @param  UserRepository $users
     * 
     * @return \Illuminate\Http\Response
     */
    public function store(Request $request)
    {
        $request-&gt;validate([
            'title' =&gt; 'string|required|max:255',
            'body'  =&gt; 'string|required'
        ]);

        // Create new ticket
        $ticket = Ticket::create($request-&gt;only('title', 'body'));

        return redirect()-&gt;route('ticket.new')-&gt;withSuccess('Thank you for raising a ticket. We will get back to you at the earliest.');
    }
}
</code></pre>

<ul>
<li>Creating Routes :</li>
</ul>

<p>Create a new file called <code>TicketRoutes.php</code> inside <code>Modules/Ticket</code>.</p>

<pre><code class="php">&lt;?php 

Route::group(['namespace' =&gt; 'Modules\Ticket', 'middleware' =&gt; ['web', 'auth']], function () {

    Route::get('ticket/new', [ 'as' =&gt; 'ticket.new', 'uses' =&gt; 'TicketController@create' ]);
    Route::post('ticket/store', [ 'as' =&gt; 'ticket.store', 'uses' =&gt; 'TicketController@store' ]);
});
</code></pre>

<p>We need to tell laravel to register these routes as those are coming from a custom folder. We can do that from service provider :</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket;

use Illuminate\Support\ServiceProvider as BaseServiceProvider;

class TicketServiceProvider extends BaseServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot() {

        // Load ticket module migrations from 
        // `Modules/Ticket/Migrations` folder path
        $this-&gt;loadMigrationsFrom(__DIR__.'/Migrations');

        // Load routes
        $this-&gt;loadRoutesFrom(__DIR__.'/TickerRoutes.php');
    }

    /**
     * Register any application services.
     *
     * @return void
     */
    public function register() {}
}
</code></pre>

<ul>
<li>Creating Views :</li>
</ul>

<p>Create a new directory inside <code>Modules/Ticket</code> called <code>Views</code>. This will contain al views for our module. This is again not coming from Laravel's default <code>resources/views</code> folder. We need to tell laravel to load these views. It can be done from service provider by adding following in boot method.</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket;

use Illuminate\Support\ServiceProvider as BaseServiceProvider;

class TicketServiceProvider extends BaseServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot() {

        // Load ticket module migrations from 
        // `Modules/Ticket/Migrations`
        $this-&gt;loadMigrationsFrom(__DIR__.'/Migrations');

        // Load routes from `Modules/Ticket/TickerRoutes.php`
        $this-&gt;loadRoutesFrom(__DIR__.'/TickerRoutes.php');

        // Load views from `Modules/Ticket/Views`
        $this-&gt;loadViewsFrom(__DIR__.'/Views', 'ticket');
    }

    /**
     * Register any application services.
     *
     * @return void
     */
    public function register() {}
}
</code></pre>

<p>Note : Sometimes you may see <code>loadViewsFrom()</code> called without the second argument which is the package name. The difference is if you want to render a view without a package name you do <code>ticket.create</code> (file path : <code>Modules/Ticket/Views/ticket/create.blade.php</code>. If you specify package name, you do <code>ticket::create</code> (file path : <code>Modules/Ticket/Views/create.blade.php</code>)</p>

<p>Let's create a simple view <code>create.blade.php</code> which basically has a form :</p>

<p></p>

<pre><code>@extends('layouts.app')

@section('content')
    &lt;div class="panel panel-default"&gt;
        &lt;div class="panel-body"&gt;
            &lt;div class="col-md-4 col-md-offset-4"&gt;
                &lt;form role="form" method="POST" action="{{ route('ticket.store') }}"&gt;
                    @csrf
                    &lt;div class="form-group"&gt;
                        &lt;label&gt;Title *&lt;/label&gt;
                        &lt;input class="form-control" placeholder="Title for your ticket" id="title" name="title"&gt;
                        @if ($errors-&gt;has('title'))
                            &lt;span class="invalid-feedback" role="alert"&gt;
                                &lt;strong&gt;{{ $errors-&gt;first('title') }}&lt;/strong&gt;
                            &lt;/span&gt;
                        @endif
                    &lt;/div&gt;
                    &lt;div class="form-group"&gt;
                        &lt;label&gt;Description *&lt;/label&gt;
                        &lt;textarea class="form-control" placeholder="How can we assist you?" id="body" name="body"&gt;&lt;/textarea&gt;
                        @if ($errors-&gt;has('body'))
                            &lt;span class="invalid-feedback" role="alert"&gt;
                                &lt;strong&gt;{{ $errors-&gt;first('body') }}&lt;/strong&gt;
                            &lt;/span&gt;
                        @endif
                    &lt;/div&gt;
                    &lt;button type="submit" class="btn btn-primary"&gt;Submit Ticket&lt;/button&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
@endsection
</code></pre>

<p></p>

<ul>
<li>Creating Policies :</li>
</ul>

<p>If you would like to use policy to authorize the requests, create a file <code>TicketPolicy.php</code> inside <code>Modules/Ticket</code>.</p>

<pre><code class="php">&lt;?php

namespace App\Modules;

use App\User;


class TicketPolicy
{

    /**
     * Determines user access
     *
     * @param User $user
     * @return bool
     */
    public function index($user)
    {
        return true;
    }

    /**
     * Determines user access
     *
     * @param User $user
     * @return bool
     */
    public function store($user)
    {
        return true;
    }
}
</code></pre>

<p>As you must have thought by now, we need to register the policy using the laravel Gate contract inside service provider :</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket;

use Modules\Ticket\Ticket.php;
use Modules\Ticket\TicketPolicy.php;
use Illuminate\Contracts\Auth\Access\Gate as GateContract;
use Illuminate\Support\ServiceProvider as BaseServiceProvider;

class TicketServiceProvider extends BaseServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot(GateContract $gate) {

        // Load ticket module migrations from 
        // `Modules/Ticket/Migrations`
        $this-&gt;loadMigrationsFrom(__DIR__.'/Migrations');

        // Load routes from `Modules/Ticket/TickerRoutes.php`
        $this-&gt;loadRoutesFrom(__DIR__.'/TickerRoutes.php');

        // Load views from `Modules/Ticket/Views`
        $this-&gt;loadViewsFrom(__DIR__.'/Views', 'ticket');

        // Load the policies from `Modules/Ticket/TicketPolicy.php`
        $gate-&gt;policy(Ticket::class, TicketPolicy::class);
    }

    /**
     * Register any application services.
     *
     * @return void
     */
    public function register() {}
}
</code></pre>

<ul>
<li>Creating config files :</li>
</ul>

<p>We can have config files to access environmental variables specific for this module. For example in this ticket module let's say we need to configure an email to cc to. Create a file <code>TicketConfig.php</code> inside inside <code>Modules/Ticket</code>.</p>

<pre><code class="php">&lt;?php

return [

    /*
    |--------------------------------------------------------------------------
    | Email to cc for submitted tickets
    |--------------------------------------------------------------------------
    |
    | Type : string
    |
    */

    'ticket_cc_email' =&gt; env('TICKET_CC_EMAIL', null),

];
</code></pre>

<p>Now, let's register this inside service provider.</p>

<pre><code class="php">&lt;?php

namespace Modules\Ticket;

use Modules\Ticket\Ticket.php;
use Modules\Ticket\TicketPolicy.php;
use Illuminate\Contracts\Auth\Access\Gate as GateContract;
use Illuminate\Support\ServiceProvider as BaseServiceProvider;

class TicketServiceProvider extends BaseServiceProvider
{
    /**
     * Bootstrap any application services.
     *
     * @return void
     */
    public function boot(GateContract $gate) {

        // Load ticket module migrations from 
        // `Modules/Ticket/Migrations`
        $this-&gt;loadMigrationsFrom(__DIR__.'/Migrations');

        // Load routes from `Modules/Ticket/TickerRoutes.php`
        $this-&gt;loadRoutesFrom(__DIR__.'/TickerRoutes.php');

        // Load views from `Modules/Ticket/Views`
        $this-&gt;loadViewsFrom(__DIR__.'/Views', 'ticket');

        // Load the policies from `Modules/Ticket/TicketPolicy.php`
        $gate-&gt;policy(Ticket::class, TicketPolicy::class);

        // Load the configurations from `Modules/Ticket/TicketConfig.php`
        $this-&gt;mergeConfigFrom(
            __DIR__.'/TicketConfig.php', 'ticket';
        );
    }

    /**
     * Register any application services.
     *
     * @return void
     */
    public function register() {}
}
</code></pre>

<p>We can then access the configurations as :</p>

<pre><code class="php">$ccEmail = config('ticket.ticket_cc_email');
</code></pre>

<p>Now you can see entire module is bundled to a single folder. Easy to manage. There is a downside of registrations inside service provider class which in general you do not worry about. However, this is structurally more intuitive and re-usable.</p>

<p>If you would like your module to have more extensive and detailed structure, you can simply use this ready composer plugin : <a href="https://nwidart.com/laravel-modules/v4/introduction">nwidart/laravel-modules</a></p>

<p>Note : The structure and coding style are my personal opinions. There can be multiple ways to accomplish the same result. I feel just knowing the possibility that it can be done, opens new doors of imaginations based on personal comfort.</p>

        </div>
        <p>.....</p>
        <a href="/blog/2019/01/06/laravel-module-pattern/">Read full article</a>
                    <p class="tags">
            Tags:
                        <a href="/blog/tags/laravel">laravel</a>,                         <a href="/blog/tags/php">php</a>,                         <a href="/blog/tags/module">module</a>,                         <a href="/blog/tags/bundle">bundle</a>                        </p>
            </article>
    <nav>
        <br />
        <a href="/page/2">Older Posts</a><br />
    </nav>
                </div>
            </div>
        </main>
        <footer class="container">
            <span>Tech.Semicolon | &copy; 2019 </span>
        </footer>

        <script src="/components/jquery/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

                    </body>
</html>
